<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Django CRUD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;1,100;1,200;1,300;1,400;1,600&display=swap" rel="stylesheet">

      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

      <style>
          *{
                font-family: 'Poppins', sans-serif;
          }
      </style>
  </head>
  <body>

  <!--    --------------------------------    -->
<!--        -->
<!--        -->
            <!-- Add line chart for Close column -->
    <div class="mt-5">
        <canvas id="lineChart" width="100" height="250"></canvas>
    </div>

    <!-- Add bar chart for Volume column -->
    <div class="mt-5">
        <canvas id="barChart" width="100" height="250"></canvas>
    </div>






<!--        -->
<!--        -->
<!--        -->
<!--        -->




    <div class="container mt-5 p-5 border rounded">

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success text-center mb-3">
                    {{message}}
                </div>
            {% endfor %}
        {% endif %}

        <div class="d-flex" justify-content-between align-items-center>
            <a href="" data-bs-toggle="modal" data-bs-target="#addDataModal" class="btn btn-primary px-3 py-3 btn-sm mx-5"> Add New Data</a>
            <div>
                <form action="" method="post" class="d-flex px-5 mx-5">
                    {% csrf_token %}
                    <input type="search" value="{{query}}" name="searchquery" class="form-control px-5 mx-2" placeholder="Search...">
                    <button class="btn btn-success mx-2" name="search">Search by Trade Code</button>
                </form>
            </div>
        </div>


        <table class="table mt-5 table-bordered" >
  <thead>
    <tr>
      <th scope="col">Date</th>
      <th scope="col">Trade Code</th>
      <th scope="col">High</th>
      <th scope="col">Low</th>
      <th scope="col">Open</th>
      <th scope="col">Close</th>
      <th scope="col">Volume</th>
      <th scope="col">Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for data in datas %}
        <tr>
            <th>{{data.date}}</th>
            <td>{{data.trade_code}}</td>
            <td>{{data.high}}</td>
            <td>{{data.low}}</td>
            <td>{{data.open}}</td>
            <td>{{data.close}}</td>
            <td>{{data.volume}}</td>
            <td>
                <a href="" data-bs-toggle="modal" data-bs-target="#updateDataModal_{{data.id}}" class="btn btn-success btn-sm"><i class="fa-solid fa-pen-to-square"></i></a>
                <a href="" data-bs-toggle="modal" data-bs-target="#deleteDataModal_{{data.id}}" class="btn btn-danger btn-sm"><i class="fa-solid fa-trash"></i></a>
            </td>
        </tr>
<!--    Update Data Modal-->
            <div class="modal fade" id="updateDataModal_{{data.id}}" tabindex="-1" aria-labelledby="updateDataModalLabel_{{data.id}}" aria-hidden="true">
                  <div class="modal-dialog">
                    <form action="" method="post">
                        {% csrf_token %}

                      <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="updateDataModalLabel_{{data.id}}">Add New Data</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <input type="hidden" name="id" value="{{data.id}}">
                        <div>
                            <label for="date">Date</label>
                            <input type="date" name="date" class="form-control" value="{{data.date}}" id="date" required>
                        </div>
                          <br>
                        <div>
                            <label for="trade_code">Trade Code</label>
                            <input type="text" name="trade_code" class="form-control" value="{{data.trade_code}}" id="trade_code" required>
                        </div>
                          <br>

                        <div>
                            <label for="high">High</label>
                            <input type="number" name="high" class="form-control" value="{{data.high}}" id="high" required>
                        </div>
                          <br>

                        <div>
                            <label for="low">Low</label>
                            <input type="number" name="low" class="form-control" value="{{data.low}}" id="low" required>
                        </div>
                          <br>


                        <div>
                            <label for="open">Open</label>
                            <input type="number" name="open" class="form-control" value="{{data.open}}" id="open" required>
                        </div>
                          <br>

                        <div>
                            <label for="close">Close</label>
                            <input type="number" name="close" class="form-control" value="{{data.close}}" id="close" required>
                        </div>
                          <br>

                        <div>
                            <label for="volume">Volume</label>
                            <input type="number" name="volume" class="form-control" value="{{data.volume}}" id="volume" required>
                        </div>
                          <br>


                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" name="update">Update this Data</button>
                      </div>
                    </div>
                  </div>
                    </form>
                </div>
            </div>


                    <!-- Delete Modal -->

            <div class="modal fade" id="deleteDataModal_{{data.id}}" tabindex="-1" aria-labelledby="deleteDataModalLabel_{{data.id}}" aria-hidden="true">
                  <div class="modal-dialog">
                    <form action="" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="'id" value="{{data.id}}">

                      <div class="modal-content">

                      <div class="modal-body">
                          <p>Are you sure you want to delete this data?</p>

                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-danger" name="delete">Yes, Delete Data</button>
                      </div>
                    </div>

                    </form>
                </div>
            </div>





    {% endfor %}

  </tbody>
</table>



    </div>

    <!-- Modal -->
<div class="modal fade" id="addDataModal" tabindex="-1" aria-labelledby="addDataModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form action="" method="post">
    {% csrf_token %}


      <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="addDataModalLabel">Add New Data</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div>
            <label for="date">Date</label>
            <input type="date" name="date" class="form-control" id="date" required>
        </div>
          <br>
        <div>
            <label for="trade_code">Trade Code</label>
            <input type="text" name="trade_code" class="form-control" id="trade_code" required>
        </div>
          <br>

        <div>
            <label for="high">High</label>
            <input type="number" name="high" class="form-control" id="high" required>
        </div>
          <br>

        <div>
            <label for="low">Low</label>
            <input type="number" name="low" class="form-control" id="low" required>
        </div>
          <br>


        <div>
            <label for="open">Open</label>
            <input type="number" name="open" class="form-control" id="open" required>
        </div>
          <br>

        <div>
            <label for="close">Close</label>
            <input type="number" name="close" class="form-control" id="close" required>
        </div>
          <br>

        <div>
            <label for="volume">Volume</label>
            <input type="number" name="volume" class="form-control" id="volume" required>
        </div>
          <br>


      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" name="add">Add new Data</button>
      </div>
    </div>
  </div>
    </form>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</div>

<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Code to fetch data and create charts
        // You will need to retrieve the necessary data from your Django view and format it appropriately
        // For demonstration purposes, assume 'closeData' contains close values and 'volumeData' contains volume values

        var ctx = document.getElementById('lineChart').getContext('2d');
        var lineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ sorted_dates|safe }}, // Replace with your sorted dates from Django view
                datasets: [{
                    label: 'Close',
                    data: {{ close_values|safe }}, // Replace with your close values from Django view
                    borderColor: 'blue',
                    backgroundColor: 'black',
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
                // Add other chart options as needed
            }
        });

        var volumeCtx = document.getElementById('barChart').getContext('2d');
        var barChart = new Chart(volumeCtx, {
            type: 'bar',
            data: {
                labels: {{ sorted_dates|safe }}, // Replace with your sorted dates from Django view
                datasets: [{
                    label: 'Volume',
                    data: {{ volume_values|safe }}, // Replace with your volume values from Django view
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
                // Add other chart options as needed
            }
        });
    });
</script>


<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->
<!-- ------------------------------------- -->


  </body>
</html>